<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CG Bazar Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

    <!-- প্রথম টেবিল -->
    <div class="gold-table">
        <h1 class="text-3xl font-bold text-center mb-8">ঢাকার স্বর্ণের বাজার এর মূল্য তালিকা</h1>
        <table>
            <thead>
                <tr>
                    <th>স্বর্ণ</th>
                    <th>বিবরণ</th>
                    <th>মূল্য (BDT)</th>
                </tr>
            </thead>
            <tbody id="goldTableBDT">
                <tr><td colspan="3">লোড হচ্ছে...</td></tr>
            </tbody>
        </table>
        <p id="timestampBDT" class="timestamp">সর্বশেষ আপডেট: তথ্য পাওয়া যায়নি</p>
    </div>

    <!-- দ্বিতীয় টেবিল -->
    <div class="gold-table">
        <h1 class="text-3xl font-bold text-center mb-8">নতুন গহনা ক্রয়</h1>
        <table>
            <thead>
                <tr>
                    <th>বিভাগ</th>
                    <th>বিবরণ</th>
                    <th>মূল্য (BDT)</th>
                </tr>
            </thead>
            <tbody id="additionalGoldTableBDT">
                <tr><td colspan="3">লোড হচ্ছে...</td></tr>
            </tbody>
        </table>
        <p id="additionalTimestampBDT" class="timestamp">সর্বশেষ আপডেট: তথ্য পাওয়া যায়নি</p>
    </div>

    <!-- তৃতীয় টেবিল -->
    <div class="gold-table">
        <h1 class="text-3xl font-bold text-center mb-8">চারিগ্রাম জুয়েলারী বাজার দর</h1>
        <table id="marketTable">
            <thead>
                <tr>
                    <th>বিভাগ</th>
                    <th>বিবরণ</th>
                    <th>মূল্য (BDT)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="3">লোড হচ্ছে...</td></tr>
            </tbody>
        </table>
        <p id="marketTimestamp" class="timestamp">সর্বশেষ আপডেট: তথ্য পাওয়া যায়নি</p>
    </div>

    <script>
        async function fetchGoldPrice() {
            const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSqWaPbAYkUS5jLUJtBQBS4uD14-F0Fipp15yJboAtvf6gdHH_aKMQKQuw4RYjHnSOCkONBYxUNWviU/pub?output=csv";
            
            try {
                const response = await fetch(sheetUrl);
                if (!response.ok) throw new Error("ডাটা লোড করতে সমস্যা হয়েছে!");

                const csvText = await response.text();
                const rows = csvText.split("\n").map(row => row.split(","));

                let lastUpdated = "তথ্য পাওয়া যায়নি";
                if (rows[15] && rows[15][0]) lastUpdated = rows[15][0].trim();
                if (rows[16] && rows[16][0]) lastUpdated += " " + rows[16][0].trim();

                document.getElementById("timestampBDT").innerHTML = 
                    `সর্বশেষ আপডেট: <span style="color: red;">${lastUpdated}</span>`;

                document.getElementById("additionalTimestampBDT").innerHTML = 
                    `সর্বশেষ আপডেট: <span style="color: red;">${lastUpdated}</span>`;

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById("goldTableBDT").innerHTML = 
                    `<tr><td colspan="3">⚠️ আপডেট করতে সমস্যা হয়েছে!</td></tr>`;
            }
        }

        async function fetchMarketRates() {
            const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTQZHciJ3vmBxMds7ohHyTt8HLHBtjLFanV81BAsFVXRudIdN5Wi3jchbsr12hivpNp3orH8g2VrEN8/pub?output=csv";
            
            try {
                const response = await fetch(sheetUrl);
                if (!response.ok) throw new Error("ডাটা লোড করতে সমস্যা হয়েছে!");

                const csvText = await response.text();
                const rows = csvText.split("\n").map(row => row.split(","));

                let lastUpdated = "তথ্য পাওয়া যায়নি";
                if (rows[15] && rows[15][0]) lastUpdated = rows[15][0].trim();
                if (rows[16] && rows[16][0]) lastUpdated += " " + rows[16][0].trim();

                let tableBody = "";
                for (let i = 0; i < 15; i++) {
                    if (rows[i].length >= 3) {
                        tableBody += `
                            <tr>
                                <td>${rows[i][0]}</td>
                                <td>${rows[i][1]}</td>
                                <td>${rows[i][2]}</td>
                            </tr>
                        `;
                    }
                }

                document.getElementById("marketTable").querySelector("tbody").innerHTML = tableBody;
                document.getElementById("marketTimestamp").innerHTML = 
                    `সর্বশেষ আপডেট: <span style="color: red;">${lastUpdated}</span>`;

            } catch (error) {
                console.error("Error fetching market rates:", error);
                document.getElementById("marketTable").querySelector("tbody").innerHTML = 
                    `<tr><td colspan="3">⚠️ ডাটা লোড করতে ব্যর্থ!</td></tr>`;
            }
        }

        fetchGoldPrice();
        fetchMarketRates();

        setInterval(() => {
            fetchGoldPrice();
            fetchMarketRates();
        }, 300000);
    </script>

</body>
</html>
